# DDBOAT Control Project

This project controls a drone boat (DDBOAT) using various sensors such as GPS, IMU (magnetometer, accelerometer, gyroscope), and motor controllers. The boat is programmed to follow predefined missions involving heading control, waypoint navigation, and circular trajectory following.

**Demonstration and explanatory video available by** [**clicking here (September 2024).**](https://www.youtube.com/watch?v=n9koBU_pk7A)

## Table of Contents
- [Requirements](#requirements)
- [Connection Setup](#connection-setup)
- [Project Structure](#project-structure)
- [How to Run the Missions](#how-to-run-the-missions)
- [Authors](#authors)

## Requirements
To run this project, you need:
- A DDBOAT equipped with GPS, IMU (magnetometer, accelerometer, gyroscope), and motors controlled via Arduino.
- Access to the DARTAP WiFi network.
- SSH access to the DDBOAT.

## Connection Setup

Before running any mission, follow these steps:

1. **Connect to DARTAP WiFi**:
   - Ensure your machine is connected to the DARTAP WiFi network.

2. **SSH into the DDBOAT**:
   - Open a terminal and use the following SSH command:
     ```bash
     ssh ue32@172.20.25.2XX
     ```
   - Replace `XX` with the correct DDBOAT number.

## Project Structure

This project includes several key Python scripts and modules:

- **ws3k2_drivers.py**: Contains the `WS3K2` class for controlling the boat's motors, GPS navigation, and heading adjustments.
- **mini_roblib.py**: Contains helper functions like `sawtooth` (for error correction) and rotation matrix calculations.
- **calibration.py**: A script to obtain the calibration data and store it in `calibration_data.npz`.


- **get_heading.py**: Interfaces with the IMU to compute the boat's heading.
- **get_gps.py**: Interfaces with the GPS device to fetch and convert GPS coordinates.
- **write_log.py**: A logging utility for recording the boat's data, such as position, heading, and correction values, into CSV files.
- **ms_come_back.py**: A script where the boat navigates back to a predefined home location.
- **client_server.py**: This script defines the communication between a server and a client using sockets. The server continuously reads GPS data and sends it to connected clients.

- **ms_round_trip.py**: A script that uses the methods of the `WS3K2` class.
- **ms_fix_circle.py**: This code is structured with a class `MSCircle` that calculates a circular trajectory based on a specified radius, period, and center function.
- **ms_circle.py**: This code usethe `MSCircle` class, which calculates a circular trajectory based on a specified radius, period, and a center function provided by the `WS3K2` class. The trajectory is dynamically generated by using the `get_gps_server_xy` method from `WS3K2`.
- **ms_follow_boat.py**: This code defines a class `MSFollow`, which allows a boat to follow another boat in real-time by fetching its GPS coordinates from a server using the `get_gps_server_xy` method. The boat follows the other boat's position continuously by using the `follow_virtual_point` method from the `WS3K2` class.
- **ms_navtowp_swarm.py**: This script identifies the boat by parsing the hostname and performs a calibration procedure. It then uses the `WS3K2` class to navigate the boat to a predefined waypoint, which is the GPS coordinates of a buoy.
- **consensus.py**: This script determines the leader in a swarm of boats by reading boat IDs from `config.txt`. The leader runs a fixed-circle mission, while sidekick boats follow the leader. It manages the process using subprocess calls to other mission scripts like `ms_fix_circle.py` and `ms_follow_boat.py`.


## How to Run the Missions

Once connected to the DDBOAT via SSH, you can execute any of the missions by following these steps:

1. **Run a mission**:
   - Each mission script corresponds to a different task. For instance, to run the **round_trip** mission:
     ```bash
     python3 ms_round_trip.py
     ```

2. **Mission Descriptions (by chronological order)**:
   - **ms_round_trip.py**: The boat moves northwest for 30 seconds, then rotates to face southeast, and moves southeast for another 30 seconds.
   - **ms_fix_circle.py**: The boat follows a circular trajectory around predefined GPS coordinates. The trajectory is dynamically calculated over time.
   - **ms_circle.py**: The boat follows a circular trajectory around a point whose coordinates are obtained from a server. The trajectory is dynamically calculated over time, and the boat returns to its initial starting point after completing the circle.
   - **ms_follow_boat.py**: The boat follows another boat by continuously updating its position through a server using GPS data. The target boat’s ID is passed as an argument.
   - **ms_navtowp_swarm.py**: The boat identifies its ID from the hostname, performs calibration, and navigates to a predefined waypoint (a buoy) using GPS coordinates.
   - **consensus.py**: This script determines the leader and sidekicks within a group of boats. The leader executes the circular mission using `ms_fix_circle.py`, while the sidekicks follow the leader's movement using `ms_follow_boat.py`.

3. **Logging**:
   - Each mission logs critical data such as GPS coordinates, heading, correction values, and distance to a CSV file (`logs/{timestamp}.csv`) on the boat. This log can be reviewed after the mission for analysis.

## Authors

This project was developed by:
- **BOURIN Toméo**, **DUNOT Clément**, **FLEURY Vianney** 

From **ENSTA Bretagne ROB 26**.
